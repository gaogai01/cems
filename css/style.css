/* ==========================================================================
   1. 全域變數定義 (CSS Variables)
   說明：這裡定義了所有的顏色變數，方便統一管理與切換深色模式
   ========================================================================== */
:root {
    /* 基礎背景與文字顏色 */
    --bg-body: #f0f2f5; 
    --bg-card: #ffffff; 
    --text-main: #2c3e50; 
    --text-sub: #666666; 
    --text-value: #2c3e50;
    --border-color: #e0e0e0; 
    --shadow: rgba(0,0,0,0.05);

    /* 狀態顏色 (背景/文字/邊框) - 用於卡片狀態 */
    --warn-bg: #fff3cd; --warn-text: #856404; --warn-border: #ffc107; /* 警告 (黃) */
    --crit-bg: #f8d7da; --crit-text: #721c24; --crit-border: #dc3545; /* 危險 (紅) */
    --run-bg:  #d1e7dd; --run-text:  #0f5132; --run-border:  #198754; /* 運轉 (綠) */

    /* 儀表板條 (Gauge) 顏色 */
    --gauge-good: #28a745; 
    --gauge-warn: #ffc107; 
    --gauge-bad: #dc3545; 
    --gauge-bg: #e9ecef; /* 儀表底色 */

    /* 趨勢圖漲跌顏色 */
    --trend-up: #dc3545;   /* 紅色代表數值上升 (或異常) */
    --trend-down: #28a745; /* 綠色代表數值下降 (或正常) */
}

/* ==========================================================================
   2. 深色模式 (Dark Mode)
   說明：當 body 有 data-theme="dark" 屬性時，覆蓋上述變數
   ========================================================================== */
[data-theme="dark"] {
    --bg-body: #121212; 
    --bg-card: #1e1e1e; 
    --text-main: #e0e0e0; 
    --text-sub: #aaaaaa; 
    --text-value: #ffffff;
    --border-color: #333333; 
    --shadow: rgba(0,0,0,0.5);
    
    /* 深色模式下的狀態顏色微調，避免太刺眼 */
    --warn-bg: #423605; --warn-text: #ffda6a; --warn-border: #997404;
    --crit-bg: #4c1116; --crit-text: #ff8592; --crit-border: #a81624;
    --run-bg:  #051b11; --run-text:  #75b798; --run-border:  #198754;
    --gauge-bg: #333;
}

/* ==========================================================================
   3. 基礎排版 (Base Layout)
   ========================================================================== */
body { 
    font-family: "Microsoft JhengHei", Arial, sans-serif; 
    background-color: var(--bg-body); 
    color: var(--text-main); 
    margin: 0; 
    padding: 0; 
    transition: background 0.3s; /* 切換主題時的平滑過渡 */
}

.container { 
    max-width: 100%; 
    padding: 10px; 
}

/* ==========================================================================
   4. 頁面標題區 (Page Header)
   ========================================================================== */
.page-header { 
    background: var(--bg-card); 
    padding: 8px 15px; 
    border-radius: 6px; 
    box-shadow: 0 2px 5px var(--shadow); 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 10px; 
    border-left: 5px solid #007bff; /* 左側藍色裝飾線 */
    flex-wrap: wrap; 
    gap: 10px; 
}

h1 { 
    color: var(--text-main); 
    margin: 0; 
    font-size: 1.2rem; 
    letter-spacing: 1px; 
}

.header-right { 
    display: flex; 
    align-items: center; 
    gap: 8px; 
}

/* 按鈕通用樣式 */
button.btn-ctrl { 
    background: #007bff; 
    color: white; 
    border: none; 
    padding: 4px 10px; 
    border-radius: 4px; 
    cursor: pointer; 
    font-size: 0.8rem; 
    display: flex; 
    align-items: center; 
    gap: 4px; 
}
button.btn-ctrl:hover { opacity: 0.9; }

/* 特定功能按鈕顏色 */
.btn-report { background: #17a2b8; } /* 青色 */
.btn-excel { background: #28a745; }  /* 綠色 */
.btn-print { background: #6c757d; }  /* 灰色 */

/* 更新時間狀態框 */
.status-box { 
    font-size: 0.75rem; 
    color: var(--text-sub); 
    background: var(--border-color); 
    padding: 3px 8px; 
    border-radius: 10px; 
    font-weight: bold; 
}

/* ==========================================================================
   5. 主儀表板網格系統 (Dashboard Grid)
   ========================================================================== */
#app { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* 自動適應寬度，最小300px */
    gap: 10px; 
    align-items: start; 
}

.system-group { 
    background: var(--bg-card); 
    border-radius: 10px; 
    padding: 10px; 
    box-shadow: 0 1px 3px var(--shadow); 
    border: 1px solid var(--border-color); 
}

/* 系統群組標題 (藥丸狀漸層背景) */
.system-title { 
    font-size: 1rem; 
    color: #fff; 
    margin-bottom: 10px; 
    padding: 6px 15px; 
    border-radius: 50px; 
    font-weight: bold; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
}
/* 標題內的計數器樣式 */
.system-title span { 
    background: rgba(255,255,255,0.25); 
    color: #fff; 
    font-size: 0.75rem; 
    padding: 2px 8px; 
    border-radius: 10px; 
    font-weight: bold; 
}

/* 各系統的標題漸層色定義 */
.group-d01 .system-title { background: linear-gradient(135deg, #007bff, #0056b3); } /* 藍 */
.group-d02 .system-title { background: linear-gradient(135deg, #20c997, #198754); } /* 綠 */
.group-wm01 .system-title { background: linear-gradient(135deg, #17a2b8, #117a8b); } /* 青 */
.group-wm02 .system-title { background: linear-gradient(135deg, #6f42c1, #59359a); } /* 紫 */
.group-wm05 .system-title { background: linear-gradient(135deg, #fd7e14, #d35400); } /* 橘 */
.group-cds .system-title { background: linear-gradient(135deg, #e83e8c, #c2175b); } /* 粉紅 */
.group-acc .system-title { background: linear-gradient(135deg, #343a40, #212529); } /* 黑 */

/* 群組內部的卡片排列 (一列兩欄) */
.inner-grid { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 8px; 
}

/* ==========================================================================
   6. 監控卡片樣式 (Monitor Cards)
   ========================================================================== */
.card { 
    background: var(--bg-body); 
    border-radius: 6px; 
    padding: 6px 10px; 
    border: 1px solid var(--border-color); 
    border-top: 3px solid #ccc; /* 預設頂部線條 */
    position: relative; 
    transition: background-color 0.3s; 
}

/* 卡片頂部線條顏色跟隨群組 */
.group-d01 .card { border-top-color: #007bff; } 
.group-wm01 .card { border-top-color: #17a2b8; } 
.group-wm02 .card { border-top-color: #6f42c1; }
.group-wm05 .card { border-top-color: #fd7e14; } 
.group-d02 .card { border-top-color: #20c997; } 
.group-cds .card { border-top-color: #e83e8c; } 
.group-acc .card { border-top-color: #343a40; }

/* --- 卡片狀態樣式 (警報/運轉) --- */
.card.status-running { background-color: var(--run-bg); border-top-color: var(--run-border) !important; animation: pulse-green 3s infinite; }
.card.status-running .value, .card.status-running .tag-name { color: var(--run-text); }

.card.status-warning { background-color: var(--warn-bg); border-top-color: var(--warn-border) !important; animation: pulse-orange 2s infinite; }
.card.status-warning .value, .card.status-warning .tag-name { color: var(--warn-text); }

.card.status-critical { background-color: var(--crit-bg); border-top-color: var(--crit-border) !important; animation: pulse-red 1.5s infinite; }
.card.status-critical .value, .card.status-critical .tag-name { color: var(--crit-text); font-weight: 900; }

/* 呼吸燈動畫 */
@keyframes pulse-red { 
    0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); } 
    70% { box-shadow: 0 0 0 3px rgba(220, 53, 69, 0); } 
    100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); } 
}
@keyframes pulse-green { 
    0% { box-shadow: 0 0 0 0 rgba(25, 135, 84, 0.2); } 
    50% { box-shadow: 0 0 0 2px rgba(25, 135, 84, 0); } 
    100% { box-shadow: 0 0 0 0 rgba(25, 135, 84, 0); } 
}

/* 卡片內容排版 */
.card-header { margin-bottom: 2px; border-bottom: 1px solid rgba(0,0,0,0.05); padding-bottom: 2px; display: flex; justify-content: space-between; align-items: center; }
.tag-name { font-size: 0.8rem; color: var(--text-main); font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 65%; }
.tag-id { font-size: 0.65rem; color: var(--text-sub); font-family: Consolas, monospace; opacity: 0.7; } 

.data-row { display: flex; align-items: baseline; justify-content: flex-end; margin-top: 2px; margin-bottom: 4px; }
.value { font-size: 1.4rem; font-weight: bold; color: var(--text-value); font-family: 'Arial', sans-serif; line-height: 1; }
.unit { font-size: 0.7rem; color: var(--text-sub); margin-left: 2px; }

/* 進度條/儀表條 */
.gauge-container { height: 5px; width: 100%; background: var(--gauge-bg); border-radius: 3px; position: relative; display: flex; overflow: visible; margin-top: 2px; }
.gauge-seg { height: 100%; }
.seg-good { background-color: var(--gauge-good); border-radius: 3px 0 0 3px; } 
.seg-warn { background-color: var(--gauge-warn); } 
.seg-poor { background-color: var(--gauge-bad); border-radius: 0 3px 3px 0; }
.gauge-marker { position: absolute; top: -2px; width: 2px; height: 9px; background-color: var(--text-main); border: 1px solid var(--bg-card); transform: translateX(-50%); z-index: 2; transition: left 0.5s ease; }

.loading { grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--text-sub); font-size: 1rem; }

/* ==========================================================================
   7. 彈出視窗 (Modal)
   ========================================================================== */
.modal { 
    display: none; /* 預設隱藏 */
    position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; 
    background-color: rgba(0,0,0,0.6); 
}
.modal-content { 
    background-color: var(--bg-card); color: var(--text-main); 
    margin: 2% auto; padding: 15px; border-radius: 8px; 
    width: 95%; max-width: 1100px; max-height: 95vh; 
    overflow-y: auto; display: flex; flex-direction: column; 
}
.modal-header { 
    display: flex; justify-content: space-between; align-items: center; 
    margin-bottom: 10px; border-bottom: 1px solid var(--border-color); 
}
.close-btn { font-size: 1.5rem; cursor: pointer; color: var(--text-sub); }

/* 圖表控制區 */
.chart-controls { 
    display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; 
    background: var(--bg-body); padding: 8px; border-radius: 5px; align-items: center; 
}
.control-group { display: flex; flex-direction: column; min-width: 100px; flex: 1; }
.control-group label { font-size: 0.75rem; color: var(--text-sub); margin-bottom: 3px; font-weight: bold; }
select, input[type="month"] { 
    padding: 4px; border-radius: 4px; border: 1px solid var(--border-color); 
    background: var(--bg-card); color: var(--text-main); font-size: 0.85rem; 
}

/* 複選框區塊 */
.checkbox-list { max-height: 80px; overflow-y: auto; border: 1px solid var(--border-color); background: var(--bg-card); padding: 4px; border-radius: 4px; }
.checkbox-item { display: flex; align-items: center; font-size: 0.8rem; margin-bottom: 2px; color: var(--text-main); }
.checkbox-item input { margin-right: 5px; }

.chart-container { position: relative; height: 450px; width: 100%; } 

/* ==========================================================================
   8. 報表列印樣式 (Report Table)
   ========================================================================== */
.report-table { 
    width: 100%; border-collapse: collapse; font-size: 0.9rem; 
    color: #000; background: #fff; 
}
.report-table th, .report-table td { 
    border: 1px solid black; padding: 6px; text-align: center; white-space: nowrap; 
}
.report-table th { background-color: #f0f0f0; font-weight: bold; }
.report-title { font-size: 1.5rem; font-weight: bold; text-align: center; margin-bottom: 5px; color: #000; }
.report-footer { 
    margin-top: 20px; display: flex; justify-content: space-between; 
    font-size: 10pt; color: #000; padding: 0 30px; 
}

/* ==========================================================================
   9. 響應式設計 (RWD)
   ========================================================================== */
@media (max-width: 600px) { 
    #app { grid-template-columns: 1fr; } /* 手機版改為單欄 */
    h1 { font-size: 1rem; } 
    .value { font-size: 1.1rem; } 
    .modal-content { margin: 5% auto; width: 98%; padding: 10px; } 
    .chart-controls { flex-direction: column; } 
}
