<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>114年12月 環化課廠務會議報告</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; }
        .card { transition: all 0.3s ease; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

        /* 列印專用樣式 */
        @media print {
            @page { margin: 10mm; size: A4 portrait; }
            body { background-color: white; padding: 0; }
            .card { 
                break-inside: avoid; /* 避免卡片被切兩半 */
                box-shadow: none; 
                border: 1px solid #e5e7eb;
                margin-bottom: 1rem;
            }
            /* 強制列印背景顏色 (如圖表顏色) */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            
            /* 隱藏不需要列印的元素 */
            .no-print { display: none !important; }
            
            /* 調整標題區塊 */
            header { border: none !important; padding-bottom: 0 !important; margin-bottom: 1rem !important; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-6">

    <!-- Header -->
    <header class="mb-8 flex justify-between items-center bg-white p-6 rounded-xl shadow-sm border-l-4 border-blue-600">
        <div>
            <h1 class="text-2xl font-bold text-gray-900" id="headerTitle">114年12月 廠務會議 - 環化課業務報告</h1>
            <p class="text-sm text-gray-500 mt-1" id="headerSubtitle">報告人：高振凱 課長 | 數據基準：114年11月</p>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-right hidden md:block">
                <div class="text-sm text-gray-500">報告日期</div>
                <div class="font-bold text-lg" id="currentDate"></div>
            </div>
            <!-- PDF Export Button -->
            <button onclick="window.print()" class="no-print bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow inline-flex items-center transition-colors">
                <i class="fa-solid fa-file-pdf mr-2"></i>
                預覽 / 匯出 PDF
            </button>
        </div>
    </header>

    <!-- Main Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

        <!-- 1. 海淡造水量 (Trend Bar Chart) -->
        <div class="card bg-white p-6 rounded-xl shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-blue-700 flex items-center">
                    <i class="fa-solid fa-water mr-2"></i> 海淡造水量
                </h2>
                <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded">1~11月趨勢</span>
            </div>
            <div class="relative h-48">
                <canvas id="waterChart"></canvas>
            </div>
            <div class="mt-4 border-t pt-4">
                <div class="flex justify-between items-end">
                    <div>
                        <p class="text-xs text-gray-500" id="waterLabel">114年11月產量</p>
                        <p class="text-2xl font-bold text-gray-800"><span id="waterValue"></span> <span class="text-sm font-normal">噸</span></p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-gray-500">11月 YoY 成長率</p>
                        <p class="text-lg font-bold text-green-600 flex items-center justify-end" id="waterGrowth">
                            <!-- JS will populate -->
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. 儲水量 (Comparison Bar Chart) -->
        <div class="card bg-white p-6 rounded-xl shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-cyan-700 flex items-center">
                    <i class="fa-solid fa-database mr-2"></i> 儲水量比較
                </h2>
                <span class="bg-gray-100 text-gray-600 text-xs font-semibold px-2.5 py-0.5 rounded" id="storageRangeLabel">近期水位</span>
            </div>
            <div class="relative h-48">
                <canvas id="storageChart"></canvas>
            </div>
            <div class="mt-4 border-t pt-4">
                <div class="flex justify-between items-end">
                    <div>
                        <p class="text-xs text-gray-500">較上月減少</p>
                        <p class="text-2xl font-bold text-orange-600"><span id="storageDiff"></span> <span class="text-sm font-normal">噸</span></p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-gray-500">目前水位 (<span id="storageCurrentDate"></span>)</p>
                        <p class="font-bold text-gray-800 text-lg"><span id="storageLevel"></span> m</p>
                        <p class="text-xs text-gray-400"><span id="storageVolume"></span> 噸</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. 水質監測 (Status List with Values) -->
        <div class="card bg-white p-6 rounded-xl shadow-sm">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-lg font-bold text-teal-700 flex items-center">
                    <i class="fa-solid fa-microscope mr-2"></i> 水質導電率
                </h2>
                <span class="bg-teal-100 text-teal-800 text-xs font-semibold px-2.5 py-0.5 rounded">標準 < 100</span>
            </div>
            
            <div class="space-y-4">
                <!-- Item 1 -->
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-2 h-2 rounded-full bg-green-500 mr-3"></div>
                        <span class="text-sm font-medium">15000噸儲水槽</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-base font-bold text-gray-800 mr-2" id="valTank"></span>
                        <span class="text-xs text-gray-500 mr-3">μS/cm</span>
                        <i class="fa-solid fa-circle-check text-green-500"></i>
                    </div>
                </div>
                 <!-- Item 2 -->
                 <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-2 h-2 rounded-full bg-green-500 mr-3"></div>
                        <span class="text-sm font-medium">海淡機產水</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-base font-bold text-gray-800 mr-2" id="valSea"></span>
                        <span class="text-xs text-gray-500 mr-3">μS/cm</span>
                        <i class="fa-solid fa-circle-check text-green-500"></i>
                    </div>
                </div>
                 <!-- Item 3 -->
                 <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-2 h-2 rounded-full bg-green-500 mr-3"></div>
                        <span class="text-sm font-medium">RO 水</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-base font-bold text-gray-800 mr-2" id="valRO"></span>
                        <span class="text-xs text-gray-500 mr-3">μS/cm</span>
                        <i class="fa-solid fa-circle-check text-green-500"></i>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 pt-2 border-t text-center">
                 <p class="text-xs text-green-600 font-medium">
                    <i class="fa-solid fa-check-double mr-1"></i>全數符合水質標準
                </p>
            </div>
        </div>

        <!-- 4. 尿素使用量 (Trend Bar Chart) -->
        <div class="card bg-white p-6 rounded-xl shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-indigo-700 flex items-center">
                    <i class="fa-solid fa-flask mr-2"></i> 尿素使用量
                </h2>
                <span class="bg-indigo-100 text-indigo-800 text-xs font-semibold px-2.5 py-0.5 rounded">1~11月趨勢</span>
            </div>
            <div class="relative h-48">
                <canvas id="ureaChart"></canvas>
            </div>
            <div class="mt-4 border-t pt-4">
                <div class="flex justify-between items-end">
                    <div>
                        <p class="text-xs text-gray-500" id="ureaLabel">114年11月用量</p>
                        <p class="text-2xl font-bold text-gray-800"><span id="ureaValue"></span> <span class="text-sm font-normal">噸</span></p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-gray-500">11月 YoY 增加率</p>
                        <p class="text-lg font-bold text-red-500 flex items-center justify-end" id="ureaGrowth">
                            <!-- JS will populate -->
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. CEMS 空氣排放 (Dual Limit Gauge) -->
        <div class="card bg-white p-6 rounded-xl shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-orange-700 flex items-center">
                    <i class="fa-solid fa-cloud-arrow-up mr-2"></i> CEMS NOx
                </h2>
                <span class="bg-orange-100 text-orange-800 text-xs font-semibold px-2.5 py-0.5 rounded">月累積平均</span>
            </div>

            <div class="mb-2">
                <span class="text-3xl font-bold text-gray-800"><span id="cemsValue"></span> <span class="text-sm font-normal text-gray-500">ppm</span></span>
            </div>

            <!-- Visualization Container -->
            <div class="relative w-full h-8 bg-gray-100 rounded-lg mt-2 mb-1">
                <!-- Target Line (Annual Goal) -->
                <div class="absolute top-0 bottom-0 border-l-2 border-dashed border-blue-500 z-20" id="cemsTargetLine"></div>
                <div class="absolute -top-6 text-xs font-bold text-blue-600 transform -translate-x-1/2" id="cemsTargetLabel">
                    目標 <span id="cemsTargetText"></span>
                </div>

                <!-- Limit Line (Permit) -->
                <div class="absolute top-0 bottom-0 w-1 bg-red-500 z-20" id="cemsLimitLine"></div>
                <div class="absolute -top-6 text-xs font-bold text-red-600 transform -translate-x-1/2" id="cemsLimitLabel">
                    上限 <span id="cemsLimitText"></span>
                </div>

                <!-- Current Value Bar -->
                <div class="h-full bg-gradient-to-r from-green-400 to-green-600 rounded-l-lg opacity-90" id="cemsBar"></div>
            </div>

            <div class="flex justify-between text-xs text-gray-400 mt-1 mb-3">
                <span>0</span>
                <span>400 ppm</span>
            </div>
            
            <div class="space-y-2 mt-4 border-t pt-3">
                <div class="flex items-start gap-2 text-sm text-gray-700">
                    <i class="fa-solid fa-bullseye text-blue-500 mt-1"></i>
                    <p>環保局年度目標：<span class="font-bold" id="cemsTargetDesc"></span> (目前符合)</p>
                </div>
                <div class="flex items-start gap-2 text-sm text-gray-700">
                    <i class="fa-solid fa-gavel text-red-500 mt-1"></i>
                    <div>
                        <p>許可證每日標準：<span class="font-bold" id="cemsLimitDesc"></span></p>
                        <p class="text-xs text-gray-500 mt-0.5"><i class="fa-solid fa-triangle-exclamation mr-1"></i>每日不可超標超過 3 次</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 6. 放流水水質及 CWMS 出口水溫 (Multi-Progress List) -->
        <div class="card bg-white p-6 rounded-xl shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-red-700 flex items-center">
                    <i class="fa-solid fa-faucet-drip mr-2"></i> 放流水質及CWMS
                </h2>
                <span class="bg-red-100 text-red-800 text-xs font-semibold px-2.5 py-0.5 rounded">綜合監測</span>
            </div>

            <div class="space-y-4">
                <!-- COD -->
                <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span class="font-medium text-gray-700">化學需氧量 (COD)</span>
                        <span class="text-gray-500"><span id="cwmsCODVal"></span> / <span id="cwmsCODMax"></span> mg/L</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" id="cwmsCODBar"></div>
                    </div>
                </div>

                <!-- SS -->
                <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span class="font-medium text-gray-700">懸浮固體 (SS)</span>
                        <span class="text-gray-500"><span id="cwmsSSVal"></span> / <span id="cwmsSSMax"></span> mg/L</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" id="cwmsSSBar"></div>
                    </div>
                </div>

                <!-- Oil -->
                <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span class="font-medium text-gray-700">油脂 (Oil)</span>
                        <span class="text-gray-500"><span id="cwmsOilVal"></span> / <span id="cwmsOilMax"></span> mg/L</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" id="cwmsOilBar"></div>
                    </div>
                </div>

                 <!-- Flow -->
                 <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span class="font-medium text-gray-700">每日流量</span>
                        <span class="text-gray-500"><span id="cwmsFlowVal"></span> / <span id="cwmsFlowMax"></span> CMD</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-indigo-500 h-2 rounded-full" id="cwmsFlowBar"></div>
                    </div>
                </div>

                <!-- Temp -->
                <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span class="font-medium text-gray-700">出口水溫</span>
                        <span class="text-gray-500"><span id="cwmsTempVal"></span> / <span id="cwmsTempMax"></span> °C</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" id="cwmsTempBar"></div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 pt-3 border-t flex items-center justify-center">
                 <span class="text-xs font-bold text-green-600 bg-green-100 px-3 py-1 rounded-full border border-green-200">
                    <i class="fa-solid fa-check-double mr-1"></i>全數符合排放標準
                </span>
            </div>
        </div>

        <!-- 7. 重點行程與業務規劃 (List View) -->
        <div class="card bg-white p-6 rounded-xl shadow-sm md:col-span-2 lg:col-span-3">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-purple-700 flex items-center">
                    <i class="fa-solid fa-calendar-days mr-2"></i> 重點行程與業務規劃
                </h2>
                <span class="bg-purple-100 text-purple-800 text-xs font-semibold px-2.5 py-0.5 rounded">未來展望</span>
            </div>
            <div class="flex flex-col gap-0" id="scheduleContainer">
                <!-- Javascript will populate this as a list -->
            </div>
        </div>

    </div>

    <!-- Footer -->
    <footer class="mt-8 text-center text-gray-400 text-xs no-print">
        <p>台電尖山發電廠 - 環化課 | Generated by Gemini AI</p>
    </footer>

    <script>
        // ==========================================
        //  DATA CONFIGURATION AREA (請在此處修改數據)
        // ==========================================
        const REPORT_DATA = {
            // 標題與日期設定
            meta: {
                title: "114年12月 廠務會議 - 環化課業務報告",
                subTitle: "報告人：高振凱 課長 | 數據基準：114年11月",
                reportDate: "2025/12/28" 
            },
            
            // 1. 海淡造水量 (單位: 噸)
            water: {
                labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月'],
                lastYear: [3800, 3500, 4100, 4200, 3900, 4500, 4800, 4700, 4200, 4100, 4362], 
                thisYear: [4800, 5100, 5300, 5400, 5900, 6100, 6300, 6200, 5800, 5900, 6065], 
                currentMonthValue: 6065, 
                labelYear: "114",       
                labelMonth: "11"        
            },

            // 2. 尿素使用量 (單位: 噸)
            urea: {
                labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月'],
                lastYear: [150, 160, 155, 170, 180, 175, 190, 185, 170, 180, 184], 
                thisYear: [180, 190, 195, 200, 210, 215, 230, 220, 210, 220, 226], 
                currentMonthValue: 226,
                labelYear: "114",
                labelMonth: "11"
            },

            // 3. 儲水量 (Updated)
            storage: {
                // 上個月 (比較基準)
                lastMonthDate: "11/27",
                lastMonthVolume: 11092,
                lastMonthLevel: 3.76,

                // 本月 (目前)
                currentDate: "12/25",
                currentVolume: 9065.5, 
                currentLevel: 3.07,

                // 系統參數
                maxVolume: 15000, 
                maxLevel: 5.09
            },

            // 4. 水質導電率 (單位: μS/cm)
            conductivity: {
                tank15000: 15.7,
                seawater: 8.6,
                roWater: 12.9
            },

            // 5. CEMS NOx (單位: ppm)
            cems: {
                current: 240.3, // 月累積平均
                target: 247,    // 環保局年度目標
                limit: 363,     // 許可證每日標準
                scaleMax: 400   // 儀表板最大刻度
            },

            // 6. 放流水與 CWMS
            cwms: {
                cod: { current: 60, max: 100 },      // 化學需氧量
                ss: { current: 15, max: 30 },        // 懸浮固體
                oil: { current: 5, max: 10 },        // 油脂
                flow: { current: 30, max: 40 },      // 每日流量
                temp: { current: 27.96, max: 42 }    // 出口水溫
            },

            // 7. 重點行程與業務規劃
            schedule: [
                { date: "12/28", title: "廠務會議報告", desc: "114年12月份報告" },
                { date: "01/05", title: "電協會認養活動", desc: "尖山沙灘淨灘規劃" },
                { date: "01/10", title: "廢水定檢申報", desc: "法規申報截止日" },
                { date: "01/15", title: "環保局空汙查核", desc: "CEMS 數據查核" }
            ]
        };

        // ==========================================
        //  LOGIC AREA 
        // ==========================================

        // Populate Text Data
        document.getElementById('headerTitle').textContent = REPORT_DATA.meta.title;
        document.getElementById('headerSubtitle').textContent = REPORT_DATA.meta.subTitle;
        document.getElementById('currentDate').textContent = REPORT_DATA.meta.reportDate;

        // Water Text
        document.getElementById('waterLabel').textContent = `${REPORT_DATA.water.labelYear}年${REPORT_DATA.water.labelMonth}月產量`;
        document.getElementById('waterValue').textContent = REPORT_DATA.water.currentMonthValue.toLocaleString();
        const waterGrowth = ((REPORT_DATA.water.thisYear[REPORT_DATA.water.thisYear.length-1] - REPORT_DATA.water.lastYear[REPORT_DATA.water.lastYear.length-1]) / REPORT_DATA.water.lastYear[REPORT_DATA.water.lastYear.length-1] * 100).toFixed(1);
        document.getElementById('waterGrowth').innerHTML = `<i class="fa-solid fa-arrow-up mr-1"></i> ${waterGrowth}%`;

        // Urea Text
        document.getElementById('ureaLabel').textContent = `${REPORT_DATA.urea.labelYear}年${REPORT_DATA.urea.labelMonth}月用量`;
        document.getElementById('ureaValue').textContent = REPORT_DATA.urea.currentMonthValue;
        const ureaGrowth = ((REPORT_DATA.urea.thisYear[REPORT_DATA.urea.thisYear.length-1] - REPORT_DATA.urea.lastYear[REPORT_DATA.urea.lastYear.length-1]) / REPORT_DATA.urea.lastYear[REPORT_DATA.urea.lastYear.length-1] * 100).toFixed(1);
        document.getElementById('ureaGrowth').innerHTML = `<i class="fa-solid fa-arrow-up mr-1"></i> ${ureaGrowth}%`;

        // Storage Text (Updated Logic for Comparison)
        document.getElementById('storageRangeLabel').textContent = `比較：${REPORT_DATA.storage.lastMonthDate} vs ${REPORT_DATA.storage.currentDate}`;
        document.getElementById('storageCurrentDate').textContent = REPORT_DATA.storage.currentDate;
        
        document.getElementById('storageVolume').textContent = REPORT_DATA.storage.currentVolume.toLocaleString();
        document.getElementById('storageLevel').textContent = REPORT_DATA.storage.currentLevel;

        const volDiff = REPORT_DATA.storage.currentVolume - REPORT_DATA.storage.lastMonthVolume;
        const volDiffFormatted = volDiff.toLocaleString();
        
        // Dynamic Color for Difference
        const diffEl = document.getElementById('storageDiff');
        if (volDiff < 0) {
            diffEl.innerHTML = `<i class="fa-solid fa-arrow-down mr-1"></i> ${Math.abs(volDiff).toLocaleString()}`;
            diffEl.className = "text-xl font-bold text-orange-600"; // Orange/Red for decrease
        } else {
            diffEl.innerHTML = `<i class="fa-solid fa-arrow-up mr-1"></i> ${volDiff.toLocaleString()}`;
            diffEl.className = "text-xl font-bold text-blue-600"; // Blue for increase
        }

        // Conductivity Text
        document.getElementById('valTank').textContent = REPORT_DATA.conductivity.tank15000;
        document.getElementById('valSea').textContent = REPORT_DATA.conductivity.seawater;
        document.getElementById('valRO').textContent = REPORT_DATA.conductivity.roWater;

        // CEMS Logic
        document.getElementById('cemsValue').textContent = REPORT_DATA.cems.current;
        document.getElementById('cemsTargetText').textContent = REPORT_DATA.cems.target;
        document.getElementById('cemsLimitText').textContent = REPORT_DATA.cems.limit;
        document.getElementById('cemsTargetDesc').textContent = `${REPORT_DATA.cems.target} ppm`;
        document.getElementById('cemsLimitDesc').textContent = `${REPORT_DATA.cems.limit} ppm`;

        const cemsScale = REPORT_DATA.cems.scaleMax;
        const targetPct = (REPORT_DATA.cems.target / cemsScale) * 100;
        const limitPct = (REPORT_DATA.cems.limit / cemsScale) * 100;
        const currentPct = (REPORT_DATA.cems.current / cemsScale) * 100;

        document.getElementById('cemsTargetLine').style.left = `${targetPct}%`;
        document.getElementById('cemsTargetLabel').style.left = `${targetPct}%`;
        document.getElementById('cemsLimitLine').style.left = `${limitPct}%`;
        document.getElementById('cemsLimitLabel').style.left = `${limitPct}%`;
        document.getElementById('cemsBar').style.width = `${currentPct}%`;

        // CWMS Logic
        function updateProgress(id, val, max) {
            document.getElementById(`${id}Val`).textContent = val;
            document.getElementById(`${id}Max`).textContent = max;
            document.getElementById(`${id}Bar`).style.width = `${(val/max)*100}%`;
        }
        updateProgress('cwmsCOD', REPORT_DATA.cwms.cod.current, REPORT_DATA.cwms.cod.max);
        updateProgress('cwmsSS', REPORT_DATA.cwms.ss.current, REPORT_DATA.cwms.ss.max);
        updateProgress('cwmsOil', REPORT_DATA.cwms.oil.current, REPORT_DATA.cwms.oil.max);
        updateProgress('cwmsFlow', REPORT_DATA.cwms.flow.current, REPORT_DATA.cwms.flow.max);
        updateProgress('cwmsTemp', REPORT_DATA.cwms.temp.current, REPORT_DATA.cwms.temp.max);

        // Schedule Logic
        const scheduleContainer = document.getElementById('scheduleContainer');
        REPORT_DATA.schedule.forEach(item => {
            const row = document.createElement('div');
            row.className = `flex flex-col sm:flex-row sm:items-center py-3 border-b border-gray-100 last:border-0`;
            row.innerHTML = `
                <div class="sm:w-24 flex-shrink-0 mb-1 sm:mb-0">
                    <span class="inline-block bg-gray-100 text-gray-700 font-bold text-xs px-2 py-1 rounded">
                        ${item.date}
                    </span>
                </div>
                <div class="flex-grow">
                    <h4 class="font-bold text-gray-800 text-sm inline-block mr-2">${item.title}</h4>
                    <span class="text-xs text-gray-500">${item.desc}</span>
                </div>
            `;
            scheduleContainer.appendChild(row);
        });


        // ==========================
        //  CHARTS INITIALIZATION
        // ==========================

        // 1. Water Chart
        new Chart(document.getElementById('waterChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: REPORT_DATA.water.labels,
                datasets: [
                    {
                        label: '113年 (去年)',
                        data: REPORT_DATA.water.lastYear,
                        backgroundColor: '#e2e8f0',
                        borderRadius: 2,
                        barPercentage: 0.6,
                        categoryPercentage: 0.8,
                        order: 2
                    },
                    {
                        label: '114年 (今年)',
                        data: REPORT_DATA.water.thisYear,
                        backgroundColor: '#3b82f6',
                        borderRadius: 2,
                        barPercentage: 0.6,
                        categoryPercentage: 0.8,
                        order: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, align: 'end' },
                    tooltip: { callbacks: { label: (c) => c.dataset.label + ': ' + c.raw.toLocaleString() + ' 噸' } }
                },
                scales: { y: { display: false }, x: { grid: { display: false } } }
            }
        });

        // 2. Urea Chart
        new Chart(document.getElementById('ureaChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: REPORT_DATA.urea.labels,
                datasets: [
                    {
                        label: '113年 (去年)',
                        data: REPORT_DATA.urea.lastYear,
                        backgroundColor: '#f1f5f9',
                        borderRadius: 2,
                        barPercentage: 0.6,
                        categoryPercentage: 0.8,
                        order: 2
                    },
                    {
                        label: '114年 (今年)',
                        data: REPORT_DATA.urea.thisYear,
                        backgroundColor: '#6366f1',
                        borderRadius: 2,
                        barPercentage: 0.6,
                        categoryPercentage: 0.8,
                        order: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, align: 'end' },
                    tooltip: { callbacks: { label: (c) => c.dataset.label + ': ' + c.raw + ' 噸' } }
                },
                scales: { y: { display: false }, x: { grid: { display: false } } }
            }
        });

        // 3. Storage Chart (New Comparison Bar Chart)
        const ctxStorage = document.getElementById('storageChart').getContext('2d');
        new Chart(ctxStorage, {
            type: 'bar',
            data: {
                labels: [`${REPORT_DATA.storage.lastMonthDate}`, `${REPORT_DATA.storage.currentDate}`],
                datasets: [{
                    label: '儲水量 (噸)',
                    data: [REPORT_DATA.storage.lastMonthVolume, REPORT_DATA.storage.currentVolume],
                    backgroundColor: ['#94a3b8', '#06b6d4'], // Gray (Past), Cyan (Current)
                    borderRadius: 4,
                    barPercentage: 0.5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.raw.toLocaleString() + ' 噸';
                            }
                        }
                    },
                    annotation: { // Conceptual, standard chartjs doesn't have annotations built-in without plugin, keeping simple
                    }
                },
                scales: {
                    y: { 
                        beginAtZero: true, 
                        max: REPORT_DATA.storage.maxVolume, // Fix Y-axis to Tank Capacity
                        grid: { display: true, drawBorder: false },
                        ticks: { display: false } // Hide numbers for clean look, rely on tooltips/labels
                    },
                    x: { 
                        grid: { display: false }
                    }
                }
            }
        });

    </script>
</body>
</html>
